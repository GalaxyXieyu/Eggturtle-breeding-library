# 支付申请与技术交接清单（支付宝 + 微信）

更新时间：2026-02-28
适用范围：个人主体先接入，后续可平滑升级到个体工商户/企业主体

## 0. 是否必须先上线后申请

不是。可以先申请，再联调上线。

推荐顺序：
1. 先申请商户/应用（业务发起）。
2. 并行准备域名、HTTPS、回调地址（技术准备）。
3. 拿到支付参数后联调。
4. 回调与幂等验证通过后再开生产。

补充说明：
- 如果已有可用备案域名，通常可以走 7 天快跑。
- 如果没有备案域名，备案周期常是关键阻塞项（常见 1-4 周）。
- 详细节奏见：`docs/payment/payment-go-live-quickstart.md`

## 1. 你让业务同学去做什么

### 1.1 支付宝（个人可走）

1. 注册并完成个人支付宝实名认证。
2. 进入支付宝开放平台创建应用（自用型）。
3. 申请所需支付产品（按业务实际选择）。
4. 完成平台要求的签约/审核。

### 1.2 微信支付（个人走小微商户）

1. 走小微商户入驻（无营业执照路径）。
2. 审核通过后获取商户号（`mchid`）。
3. 如需 JSAPI/小程序/App 支付，再申请并绑定 `appid`。
4. 开通 APIv3 能力（含证书/密钥相关配置）。

## 2. 业务同学最终必须交付给技术的材料

### 2.1 通用材料（两家都要）

- 主体信息：申请主体类型（个人/小微/企业）和实名名称
- 业务信息：店铺/产品名、支付场景、售卖页面 URL
- 回调信息：你计划使用的异步通知 URL（测试 + 生产）
- 财务信息：结算账户后四位、开户姓名（避免填错账号）
- 文档截图：平台后台“已开通能力”页截图

### 2.2 支付宝交付清单（必需）

- `app_id`
- 应用公钥（你方生成后上传平台）
- 支付宝公钥（平台提供）
- 支付网关/接口产品开通截图
- 异步通知地址配置截图（如产品要求）
- 沙箱/正式环境标识（当前用哪个）

### 2.3 微信支付交付清单（必需）

- `mchid`（商户号）
- `appid`（如使用 JSAPI/小程序/App）
- `apiV3Key`（APIv3 密钥）
- API 证书序列号（`serial_no`）
- 商户私钥文件（`apiclient_key.pem`）
- 平台证书序列号（微信平台证书）
- 回调 URL 配置截图

### 2.4 强制约束（避免后面返工）

- 私钥文件只走安全通道，不发群聊。
- 所有 ID 统一放到一个交接表，字段名和大小写不要改。
- 回调 URL 必须是 HTTPS 且外网可访问。

## 3. 技术接入步骤（拿到材料后）

1. 填写后端环境变量（见 `apps/api/.env.example` 中 PAYMENT 段）。
2. 打开开关：`PAYMENT_FEATURE_ENABLED=true`。
3. 在后台检查配置状态：`GET /payments/readiness`。
4. 对接“下单接口”和“异步回调接口”（微信/支付宝分开）。
5. 以 webhook 回调作为最终支付成功依据，更新订阅/权益。
6. 做幂等：按平台事件号去重，防止重复发货/重复开通权益。

## 4. 本项目当前约定（已落地）

- 已预留 API 模块：`apps/api/src/payments`
- 默认关闭，不会影响现有业务接口
- 已预留回调入口：
  - `POST /payments/webhooks/wechat`
  - `POST /payments/webhooks/alipay`
- 已预留配置检查入口：
  - `GET /payments/readiness`

## 5. 给业务同学的一句话模板

请按“支付申请与技术交接清单”提交完整资料，尤其是：
- 支付宝：`app_id` + 应用公钥 + 支付宝公钥
- 微信：`mchid` + `apiV3Key` + 商户私钥 + 平台证书
未齐全前，技术不会开启支付功能。

## 6. 官方参考（2026-02-28 核对）

- 支付宝接入流程：https://open.alipay.com/develop/accessProcessPage.htm
- 微信普通商户准入说明：https://pay.wechatpay.cn/doc/v3/merchant/4012670908
- 微信小微商户入驻：https://pay.wechatpay.cn/doc/v3/merchant/4013334864
- 微信小微 API 接入：https://pay.wechatpay.cn/doc/v3/merchant/4015337346
- 微信 mchid/appid 关系：https://pay.wechatpay.cn/doc/v3/merchant/4012071573
