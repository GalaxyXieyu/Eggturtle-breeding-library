# TODO: Payment Integration (Alipay + WeChat)

更新时间：2026-02-28
状态：占位完成，等待业务交付资质材料

## 前置判断（先做）

- [ ] 是否已有可用备案域名（有则走 7 天快跑）
- [ ] 若无备案域名，是否已启动备案流程（预计 1-4 周）
- [ ] 支付场景确认：H5 / JSAPI / 小程序 / App

## Phase 1: 业务申请与资料回收

- [ ] 支付宝申请完成并拿到 `app_id`
- [ ] 微信小微商户申请完成并拿到 `mchid`
- [ ] 如需 JSAPI/小程序/App，拿到并绑定 `appid`
- [ ] 回调域名 HTTPS 与公网连通验证通过

## Phase 2: 凭据入库（环境变量）

- [ ] `PAYMENT_FEATURE_ENABLED=true`
- [ ] 填写支付宝密钥与网关配置
- [ ] 填写微信 APIv3 密钥与证书配置
- [ ] 执行 `GET /payments/readiness`，确认 `ready=true`

## Phase 3: 正式接入

- [ ] 下单接口对接（按产品形态：H5/JSAPI/App）
- [ ] 回调验签与幂等落库
- [ ] 支付成功后开通租户订阅权益
- [ ] 失败/退款路径补齐

## Phase 4: 上线与运维

- [ ] 沙箱/联调用例通过
- [ ] 生产环境回调演练通过
- [ ] 对账脚本与异常告警接入
- [ ] 风控策略（重放、防刷）启用

## 备注

- 当前仓库已预留支付模块代码，默认禁用。
- 未拿到完整资质与密钥前，不应开启支付功能。
